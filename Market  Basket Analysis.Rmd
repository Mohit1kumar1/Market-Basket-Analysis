---
title: "Market Basket Analysis"
author: "Mohit"
date: "2025-02-06"
output:
  html_document: default
  pdf_document: default
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

**Data used is:** <https://archive.ics.uci.edu/dataset/352/online+retail>

**Information about dataset :** This is a transactional data set which contains all the transactions occurring between 01/12/2010 and 09/12/2011 for a UK-based and registered non-store online retail.The company mainly sells unique all-occasion gifts. Many customers of the company are wholesalers.

**Corelation:** This analysis can be performed on Kada per day data generated by CermePOS. Will be used for product placement on shelves.

1.  To calculate best sellers of the day.
2.  To calculate best sellers of each hour, within a hour, and of each weekday.
3.  To find association rules, to know which products are sold together.
4.  Renerate association rule to understand which items should be stacked together and where to place them.

```{r eruptions, echo=FALSE}
chooseCRANmirror(graphics = FALSE, ind = 1)
#install.packages("readxl")
#install.packages("dplyr")
#install.packages("lubridate")
#install.packages("arules")
#install.packages("arulesViz")
#install.packages("gglot2")
#install.packages("plotly")
help(plotly)
library(ggplot2)
library(plotly)
library(dplyr)
library(lubridate)
library(arules)
library(arulesViz)
library(readxl)
data <- read_excel("Online Retail.xlsx")
head(data)
```

```{r}
library(dplyr)

best_selling_products <- data %>%
  group_by(Description) %>%
  summarise(Total_Quantity = sum(Quantity, na.rm = TRUE)) %>%
  arrange(desc(Total_Quantity))

head(best_selling_products, 50)


ggplot(best_selling_products[1:10, ], aes(x = reorder(Description, Total_Quantity), y = Total_Quantity)) +
    #geom_point()+
    geom_bar(stat = "identity", fill = "#9c9797", colour ="#0cf00c") +
    coord_flip() +
    labs(title = "Top 20 Best Selling Products", x = "Product", y = "Total Quantity Sold")   


p <- ggplot(best_selling_products[1:10, ], aes(x = factor(Description), y = Total_Quantity, fill = Description)) +
    geom_bar(stat = "identity") +
    labs(title = "Top 10 Best Selling Products",
         x = "Product",
         y = "Total Quantity Sold",
         fill = "Product") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Convert to Plotly
ggplotly(p)
```

```{r}
library(lubridate)
library(dplyr)

best_selling_time <- data %>%
  mutate(Hour = hour(InvoiceDate)) %>%
  group_by(Hour, Description) %>%
  summarise(Total_Quantity = sum(Quantity, na.rm = TRUE), .groups = "drop") %>%
  filter(Total_Quantity > 0) %>%
  arrange(desc(Total_Quantity))

head(best_selling_time, 50)
tail(best_selling_time, 50)
 
range(best_selling_time$Hour)

# Get the best-selling product for each hour
best_selling_per_hour <- best_selling_time %>%
  group_by(Hour) %>%
  slice_max(order_by = Total_Quantity, n = 1) # Selects the top product per hour

head(best_selling_per_hour, 50)
# Plot
b <- ggplot(best_selling_per_hour, aes(x = factor(Hour), y = Total_Quantity, fill = Description)) +
  geom_bar(stat = "identity") +
  labs(title = "Best Selling Product for Each Hour",
       x = "Hour of the Day",
       y = "Total Quantity Sold",
       fill = "Product") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplotly(b)

# Get the top 5 best-selling products for each hour
top_5_per_hour <- best_selling_time %>%
  group_by(Hour) %>%
  slice_max(order_by = Total_Quantity, n = 5) %>%
  ungroup()

head(top_5_per_hour, 50)


# Plot
a <- ggplot(top_5_per_hour, aes(x = reorder(Description, Total_Quantity), 
                           y = Total_Quantity, fill = Description)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  facet_wrap(~ Hour, scales = "free_y") +  # Creates a grid of plots by Hour
  coord_flip() +  # Flips bars for better readability
  labs(title = "Top 5 Best-Selling Products for Each Hour",
       x = "Product",
       y = "Total Quantity Sold") +
  theme_minimal()

ggplotly(a)

```

```{r}
library(dplyr)
library(ggplot2)
library(plotly)
library(lubridate)

# Ensure Quantity is numeric
data <- data %>%
  mutate(Quantity = as.numeric(Quantity)) 

# Best selling products based on the day of the week
best_selling_day <- data %>%
  mutate(Weekday = weekdays(InvoiceDate)) %>%
  group_by(Weekday, Description) %>%
  summarise(Total_Quantity = sum(Quantity, na.rm = TRUE), .groups = "drop") %>%
  arrange(desc(Total_Quantity))

# Check results
head(best_selling_day, 10)

# Visualization
c <- ggplot(best_selling_day, aes(x = factor(Weekday, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")), 
                                  y = Total_Quantity, fill = Description)) +
  geom_bar(stat = "identity") +
  labs(title = "Best Selling Product for Each Weekday",
       x = "Weekday",
       y = "Total Quantity Sold",
       fill = "Product") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Convert to interactive plot
ggplotly(c)

```

```{r}
library(arules)
library(arulesViz)
library(dplyr)
library(ggplot2)

my_data <- read_excel("Online Retail.xlsx")

# Convert data to transactions format
transactions <- as(split(my_data$Description, my_data$InvoiceNo), "transactions")

# Apply Apriori Algorithm
rules <- apriori(transactions, parameter = list(support = 0.01, confidence = 0.3))

# Convert rules to a tidy data frame
rules_df <- DATAFRAME(rules, separate = TRUE)  # Explicit conversion

# Extract only the top 10 rules based on lift
top_rules <- rules_df %>%
  arrange(desc(lift)) %>%
  head(10)

# Plot using ggplot2
d <- ggplot(top_rules, aes(x = reorder(LHS, lift), y = lift, fill = RHS)) +
  geom_bar(stat = "identity") +
  coord_flip() +  # Flip for better readability
  labs(title = "Top 10 Association Rules by Lift",
       x = "LHS (Antecedent)",
       y = "Lift",
       fill = "RHS (Consequent)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ggplotly(d)
```

```{r}
rmarkdown::render("Online Retail.xlsx", output_file = "html_document")
```

\`\`\`
